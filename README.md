# ngx-locatorjs (Angular Open-in-Editor)

한국어 문서: `README.ko.md`

Open Angular component files directly from the browser with **Alt + Click** during development. This package provides:
- Browser runtime for Alt+click / hover UI
- CLI tools to scan Angular components and open files in your editor
- Config + proxy setup guidance

## Features
- **Alt + Click**: open template (.html)
- **Alt + Shift + Click**: open component (.ts)
- **Hold Alt**: highlight component + tooltip
- Supports **Cursor**, **VS Code**, **WebStorm**

## Install
```bash
npm i -D ngx-locatorjs
```

## Setup (Recommended)
```bash
npx locatorjs-config
npx locatorjs-scan
npx locatorjs-open-in-editor
```

Run Angular dev server with proxy:
```bash
ng serve --proxy-config proxy.conf.json
```

## Add to `main.ts`

### NgModule bootstrap
```ts
import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
import { AppModule } from './app/app.module';
import { environment } from './environments/environment';
import { enableProdMode } from '@angular/core';

if (environment.production) {
  enableProdMode();
}

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .then(() => {
    if (!environment.production) {
      setTimeout(() => {
        import('ngx-locatorjs')
          .then((m) => m.installAngularLocator())
          .catch((err) => console.warn('[angular-locator] Failed to load:', err));
      }, 1000);
    }
  })
  .catch((err) => console.error(err));
```

### Standalone bootstrap
```ts
import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { AppComponent } from './app/app.component';

bootstrapApplication(AppComponent, appConfig)
  .then(() => {
    setTimeout(() => {
      import('ngx-locatorjs')
        .then((m) => m.installAngularLocator())
        .catch((err) => console.warn('[angular-locator] Failed to load:', err));
    }, 1000);
  })
  .catch((err) => console.error(err));
```

## Config Guide (`open-in-editor.config.json`)
Location: project root

**Important**
- `npx locatorjs-config` uses the **current directory** as the base.
- Run it from the project root and press **Enter** for `workspaceRoot: "."`.
- In a monorepo, enter the **relative path** to your Angular app (e.g. `apps/web`).

Example:
```json
{
  "port": 4123,
  "workspaceRoot": ".",
  "editor": "cursor",
  "fallbackEditor": "code",
  "scan": {
    "includeGlobs": [
      "src/**/*.{ts,tsx}",
      "projects/**/*.{ts,tsx}",
      "apps/**/*.{ts,tsx}",
      "libs/**/*.{ts,tsx}"
    ],
    "excludeGlobs": [
      "**/node_modules/**",
      "**/dist/**",
      "**/.angular/**",
      "**/coverage/**",
      "**/*.spec.ts",
      "**/*.test.ts",
      "**/*.e2e.ts"
    ]
  }
}
```

### Field Reference
- `port`: file-opener server port
- `workspaceRoot`: actual Angular workspace root
- `editor`: default editor (`cursor`, `code`, `webstorm`)
- `fallbackEditor`: used if default fails
- `scan.includeGlobs`: component scan targets
- `scan.excludeGlobs`: scan excludes

### Recommended includeGlobs
- Simple app: `"src/app/**/*.ts"`
- Angular workspace: `"projects/**/*.{ts,tsx}"`
- Nx: `"apps/**/*.{ts,tsx}", "libs/**/*.{ts,tsx}"`

## Proxy (`proxy.conf.json`)
Generated by `npx locatorjs-config`. If a file already exists, it will merge entries.

Example:
```json
{
  "/__open-in-editor": {
    "target": "http://localhost:4123",
    "secure": false,
    "changeOrigin": true
  },
  "/__open-in-editor-search": {
    "target": "http://localhost:4123",
    "secure": false,
    "changeOrigin": true
  },
  "/__cmp-map": {
    "target": "http://localhost:4123",
    "secure": false,
    "changeOrigin": true
  }
}
```

## Environment Variable Priority
1. `EDITOR_CMD` (example: `cursor --goto`)
2. `LAUNCH_EDITOR` (example: `code`)
3. `open-in-editor.config.json` → `editor`
4. auto-detected editor

## Troubleshooting
- **CORS / JSON parse error**: ensure dev server uses `--proxy-config proxy.conf.json`
- **component-map.json not found**: run `npx locatorjs-scan`
- **Editor not opening**: install editor CLI or set `EDITOR_CMD`
- **Port conflict**: change port in both `open-in-editor.config.json` and `proxy.conf.json`

## Notes
- Use only in development (guard with `environment.production`).

## What It Can Do
- Open template or component files with Alt+click in development
- Show component highlight and tooltip while holding Alt
- Works with single apps, Angular workspace, and Nx layouts

## Limitations
- Requires proxy setup (`proxy.conf.json`), otherwise requests will fail
- Requires the file-opener server to be running
- Line matching in dynamic/repeated templates is heuristic, not perfect
- Not supported in SSR/SSG runtime (browser DOM only)
