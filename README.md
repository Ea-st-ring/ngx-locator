# ngx-locatorjs (Angular Open-in-Editor)

한국어 문서: [README.ko.md](README.ko.md)

Open Angular component files directly from the browser with **Alt + Click** during development. This package provides:
- Browser runtime for Alt+click / hover UI
- CLI tools to scan Angular components and open files in your editor
- Config + proxy setup guidance
Inspired by [locatorjs.com](https://www.locatorjs.com/).

## Features
- **Alt + Click**: open template (.html)
- **Alt + Shift + Click**: open component (.ts)
- **Hold Alt**: highlight component + tooltip
- Supports **Cursor**, **VS Code**, **WebStorm**

## Install
```bash
npm i -D ngx-locatorjs
```

## Required Steps (Do This First)
You must complete steps 1–5 for this to work.

1. Install the package: `npm i -D ngx-locatorjs`
2. Add the runtime hook to `main.ts` (see the examples below)
3. Generate config + proxy: `npx locatorjs-config`
4. Scan components: `npx locatorjs-scan`
5. Run the file-opener server and your dev server (keep both running): `npx locatorjs-open-in-editor` + `ng serve --proxy-config ngx-locatorjs.proxy.json`
   - If you use `npm run start`, pass args after `--`: `npm run start -- --proxy-config ngx-locatorjs.proxy.json`

## Add to `main.ts`

### NgModule bootstrap
```ts
import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
import { AppModule } from './app/app.module';
import { environment } from './environments/environment';
import { enableProdMode } from '@angular/core';

if (environment.production) {
  enableProdMode();
}

platformBrowserDynamic()
  .bootstrapModule(AppModule)
  .then(() => {
    if (!environment.production) {
      setTimeout(() => {
        import('ngx-locatorjs')
          .then((m) => m.installAngularLocator())
          .catch((err) => console.warn('[angular-locator] Failed to load:', err));
      }, 1000);
    }
  })
  .catch((err) => console.error(err));
```

### Standalone bootstrap
```ts
import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { AppComponent } from './app/app.component';

bootstrapApplication(AppComponent, appConfig)
  .then(() => {
    setTimeout(() => {
      import('ngx-locatorjs')
        .then((m) => m.installAngularLocator())
        .catch((err) => console.warn('[angular-locator] Failed to load:', err));
    }, 1000);
  })
  .catch((err) => console.error(err));
```

## Config Guide (`ngx-locatorjs.config.json`)
Location: project root

**Important**
- `npx locatorjs-config` uses the **current directory** as the base.
- Run it from the project root and press **Enter** for `workspaceRoot: "."`.
- In a monorepo, enter the **relative path** to your Angular app (e.g. `apps/web`).
- If `.gitignore` exists, `npx locatorjs-config` will append `.open-in-editor/`. Remove it if you want to commit the map.

Example:
```json
{
  "port": 4123,
  "workspaceRoot": ".",
  "editor": "cursor",
  "fallbackEditor": "code",
  "scan": {
    "includeGlobs": [
      "src/**/*.{ts,tsx}",
      "projects/**/*.{ts,tsx}",
      "apps/**/*.{ts,tsx}",
      "libs/**/*.{ts,tsx}"
    ],
    "excludeGlobs": [
      "**/node_modules/**",
      "**/dist/**",
      "**/.angular/**",
      "**/coverage/**",
      "**/*.spec.ts",
      "**/*.test.ts",
      "**/*.e2e.ts"
    ]
  }
}
```

### Field Reference
- `port`: file-opener server port
- `workspaceRoot`: actual Angular workspace root
- `editor`: default editor (`cursor`, `code`, `webstorm`)
- `fallbackEditor`: used if default fails
- `scan.includeGlobs`: component scan targets
- `scan.excludeGlobs`: scan excludes

### Recommended includeGlobs
- Simple app: `"src/app/**/*.ts"`
- Angular workspace: `"projects/**/*.{ts,tsx}"`
- Nx: `"apps/**/*.{ts,tsx}", "libs/**/*.{ts,tsx}"`

## Proxy (`ngx-locatorjs.proxy.json`)
Generated by `npx locatorjs-config`. If a proxy file is already referenced in `angular.json` or `proxy.conf.json` exists, it will merge entries there. Otherwise it creates `ngx-locatorjs.proxy.json`.

Example:
```json
{
  "/__open-in-editor": {
    "target": "http://localhost:4123",
    "secure": false,
    "changeOrigin": true
  },
  "/__open-in-editor-search": {
    "target": "http://localhost:4123",
    "secure": false,
    "changeOrigin": true
  },
  "/__cmp-map": {
    "target": "http://localhost:4123",
    "secure": false,
    "changeOrigin": true
  }
}
```

## Environment Variable Priority
1. `EDITOR_CMD` (example: `cursor --goto`)
2. `LAUNCH_EDITOR` (example: `code`)
3. `ngx-locatorjs.config.json` → `editor`
4. auto-detected editor

## Troubleshooting
- **CORS / JSON parse error**: ensure dev server uses `--proxy-config ngx-locatorjs.proxy.json`
- **npm run shows "Unknown cli config --proxy-config"**: use `npm run start -- --proxy-config ngx-locatorjs.proxy.json`
- **component-map.json not found**: run `npx locatorjs-scan`
- **Map is empty or missing components**: check `scan.includeGlobs` and rerun the scan
- **Wrong files open or nothing matches**: confirm `workspaceRoot` points to the actual Angular app root
- **No highlight / info is null**: make sure `/__cmp-map` is loading and includes your component class name
- **Editor not opening**: install editor CLI or set `EDITOR_CMD`
- **Port conflict**: change port in both `ngx-locatorjs.config.json` and `ngx-locatorjs.proxy.json`

## Notes
- Use only in development (guard with `environment.production`).

## One-Command Dev (Recommended)
Running the file-opener server and Angular dev server separately is tedious. You can wire them into a single script.

### Option A: `concurrently`
```bash
npm i -D concurrently
```

```json
{
  "scripts": {
    "dev:locator": "concurrently -k -n opener,ng \"npx locatorjs-open-in-editor\" \"ng serve --proxy-config ngx-locatorjs.proxy.json\""
  }
}
```

### Option B: `npm-run-all`
```bash
npm i -D npm-run-all
```

```json
{
  "scripts": {
    "locator:opener": "npx locatorjs-open-in-editor",
    "dev:app": "ng serve --proxy-config ngx-locatorjs.proxy.json",
    "dev:locator": "run-p locator:opener dev:app"
  }
}
```

## What It Can Do
- Open template or component files with Alt+click in development
- Show component highlight and tooltip while holding Alt
- Works with single apps, Angular workspace, and Nx layouts

## Limitations
- Requires proxy setup (`ngx-locatorjs.proxy.json`), otherwise requests will fail
- Requires the file-opener server to be running
- Line matching in dynamic/repeated templates is heuristic, not perfect
- Not supported in SSR/SSG runtime (browser DOM only)
